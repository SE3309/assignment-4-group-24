<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../styles/output.css">
  <title>Drivers</title>
</head>
<body class="h-screen bg-gray-50 flex">
  <!-- Sidebar -->
  <aside class="w-64 bg-gray-900 text-white flex flex-col">
    <div class="flex items-center justify-center h-16 border-b border-gray-700">
      <img src="https://tailwindui.com/plus/img/logos/mark.svg?color=indigo&shade=600" alt="Logo" class="h-8 w-auto">
    </div>
    <nav class="flex-1 px-2 py-4 space-y-2">
      <a href="dashboard.html" class="flex items-center px-4 py-2 text-sm font-medium rounded-lg hover:bg-gray-800">
        <svg class="w-5 h-5 mr-3" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M11.293 3.293a1 1 0 0 1 1.414 0l6 6 2 2a1 1 0 0 1-1.414 1.414L19 12.414V19a2 2 0 0 1-2 2h-3a1 1 0 0 1-1-1v-3h-2v3a1 1 0 0 1-1 1H7a2 2 0 0 1-2-2v-6.586l-.293.293a1 1 0 0 1-1.414-1.414l2-2 6-6Z"/>
        </svg>
        Dashboard
      </a>
      <a href="drivers.html" class="flex items-center px-4 py-2 text-sm font-medium rounded-lg bg-indigo-600">
        <svg class="w-5 h-5 mr-3" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M16 19h4a1 1 0 0 0 1-1v-1a3 3 0 0 0-3-3h-2m-2.236-4a3 3 0 1 0 0-4M3 18v-1a3 3 0 0 1 3-3h4a3 3 0 0 1 3 3v1a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1Zm8-10a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"/>
        </svg>
        Drivers
      </a>
    </nav>
  </aside>

  <!-- Main Content -->
  <div class="flex-1 flex flex-col">
    <!-- Header -->
    <header class="flex items-center justify-between px-6 py-4 bg-white shadow">
      <input
        type="text"
        placeholder="Search..."
        class="w-1/3 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-600"
      />
      <div class="flex items-center space-x-4">
        <div id="profile-initials" class="flex items-center justify-center w-10 h-10 bg-indigo-500 text-white rounded-full">HB</div>
        <button class="px-4 py-2 bg-red-500 text-white text-sm font-medium rounded-lg hover:bg-red-600 focus:outline-none">
          Logout
        </button>
      </div>
    </header>

    <!-- Sorting Toolbar -->
    <div class="flex justify-between items-center px-6 py-2 bg-white shadow">
      <h2 class="text-xl font-semibold text-gray-800">Drivers</h2>
      <div class="flex space-x-2">
        <button
          id="sort-name"
          class="flex items-center px-4 py-2 text-sm font-medium text-gray-600 border border-gray-300 rounded-full hover:text-indigo-600 hover:border-indigo-600 focus:outline-none"
        >
          <span>Sort by Name</span>
        </button>
        <button
          id="sort-license"
          class="flex items-center px-4 py-2 text-sm font-medium text-gray-600 border border-gray-300 rounded-full hover:text-indigo-600 hover:border-indigo-600 focus:outline-none"
        >
          <span>Sort by License</span>
        </button>
        <button
          id="sort-availability"
          class="flex items-center px-4 py-2 text-sm font-medium text-gray-600 border border-gray-300 rounded-full hover:text-indigo-600 hover:border-indigo-600 focus:outline-none"
        >
          <span>Sort by Availability</span>
        </button>
        <button
          id="reset-filters"
          class="flex items-center px-4 py-2 text-sm font-medium text-gray-600 border border-gray-300 rounded-full bg-red-100 hover:text-red-600 hover:border-red-600 focus:outline-none"
        >
          <span>Reset Filters</span>
        </button>
      </div>
    </div>

    <!-- Drivers Table -->
    <main class="flex-1 p-6 bg-gray-50">
      <table class="w-full bg-white border border-gray-300 rounded-lg">
        <thead class="bg-gray-100">
          <tr>
            <th class="px-6 py-3 text-left text-sm font-semibold text-gray-600 border-b">Driver ID</th>
            <th class="px-6 py-3 text-left text-sm font-semibold text-gray-600 border-b">Name</th>
            <th class="px-6 py-3 text-left text-sm font-semibold text-gray-600 border-b">License Type</th>
            <th class="px-6 py-3 text-left text-sm font-semibold text-gray-600 border-b">Availability</th>
            <th class="px-6 py-3 text-left text-sm font-semibold text-gray-600 border-b">Phone Number</th>
            <th class="px-6 py-3 text-left text-sm font-semibold text-gray-600 border-b">Dispatcher ID</th>
          </tr>
        </thead>
        <tbody id="drivers-table-body" class="divide-y divide-gray-200">
          <tr>
            <td colspan="6" class="text-center py-4 text-gray-500">Loading...</td>
          </tr>
        </tbody>
      </table>
    </main>
  </div>

  <script src="../js/api.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const sortByNameButton = document.getElementById('sort-name');
      const sortByLicenseButton = document.getElementById('sort-license');
      const sortByAvailabilityButton = document.getElementById('sort-availability');
      const resetFiltersButton = document.getElementById('reset-filters');
      const driversTableBody = document.getElementById('drivers-table-body');

      let defaultDrivers = [];
      let currentDrivers = [];

      // Fetch drivers from the API
      const fetchDrivers = async () => {
        try {
          const response = await fetch('http://localhost:3000/api/drivers');
          const drivers = await response.json();
          defaultDrivers = drivers;
          currentDrivers = [...drivers];
          populateTable(drivers);
        } catch (error) {
          console.error('Error fetching drivers:', error);
        }
      };

      // Populate the table
      const populateTable = (drivers) => {
        driversTableBody.innerHTML = '';
        drivers.forEach((driver) => {
          const row = `
            <tr>
              <td class="px-6 py-3 border">${driver.Driver_ID}</td>
              <td class="px-6 py-3 border">${driver.F_Name} ${driver.L_Name}</td>
              <td class="px-6 py-3 border">${driver.License_Type}</td>
              <td class="px-6 py-3 border">${driver.Availability ? 'Available' : 'Unavailable'}</td>
              <td class="px-6 py-3 border">${driver.Phone_No}</td>
              <td class="px-6 py-3 border">${driver.Dispatcher_ID || 'N/A'}</td>
            </tr>`;
          driversTableBody.innerHTML += row;
        });
      };

      // Sorting functions
      const sortDrivers = (key, isAscending) => {
        currentDrivers.sort((a, b) => {
          if (key === 'name') {
            const nameA = `${a.F_Name} ${a.L_Name}`.toLowerCase();
            const nameB = `${b.F_Name} ${b.L_Name}`.toLowerCase();
            return isAscending ? nameA.localeCompare(nameB) : nameB.localeCompare(nameA);
          } else if (key === 'license') {
            return isAscending
              ? a.License_Type.localeCompare(b.License_Type)
              : b.License_Type.localeCompare(a.License_Type);
          } else if (key === 'availability') {
            return isAscending
              ? (a.Availability === b.Availability ? 0 : a.Availability ? -1 : 1)
              : (a.Availability === b.Availability ? 0 : a.Availability ? 1 : -1);
          }
        });
        populateTable(currentDrivers);
      };

      // Event listeners for sorting
      let nameAsc = true;
      sortByNameButton.addEventListener('click', () => {
        sortDrivers('name', nameAsc);
        nameAsc = !nameAsc;
      });

      let licenseAsc = true;
      sortByLicenseButton.addEventListener('click', () => {
        sortDrivers('license', licenseAsc);
        licenseAsc = !licenseAsc;
      });

      let availabilityAsc = true;
      sortByAvailabilityButton.addEventListener('click', () => {
        sortDrivers('availability', availabilityAsc);
        availabilityAsc = !availabilityAsc;
      });

      // Reset filters
      resetFiltersButton.addEventListener('click', () => {
        currentDrivers = [...defaultDrivers];
        populateTable(currentDrivers);
      });

      // Initial fetch
      fetchDrivers();
    });
  </script>
</body>
</html>
